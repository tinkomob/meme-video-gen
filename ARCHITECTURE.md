# ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ¼ĞµĞ¼Ğ¾Ğ² N Ñ€Ğ°Ğ· Ğ² Ğ´ĞµĞ½ÑŒ

## ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Telegram Bot (Go)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  main.go (cmd/meme-bot)                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ loggers                               â”‚ â”‚
â”‚  â”‚  â”œâ”€ Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ scheduler.Service                            â”‚ â”‚
â”‚  â”‚  â””â”€ Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ TelegramBot                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  scheduler.Service                                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ² Service.schedule (mutex)      â”‚ â”‚
â”‚  â”‚  â”œâ”€ Ğ˜Ğ¼ĞµĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº S3Client Ğ¸ Config                    â”‚ â”‚
â”‚  â”‚  â””â”€ Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ cron Ğ´Ğ»Ñ EnsureSongs/Sources/Memes        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  TelegramBot.runSchedulePoster() (Ğ² Ğ³Ğ¾Ñ€ÑƒÑ‚Ğ¸Ğ½Ğµ)            â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Ğ¦Ğ¸ĞºĞ»:                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€ ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 10 ÑĞµĞºÑƒĞ½Ğ´                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚: Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ === Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼Ñ?       â”‚ â”‚
â”‚  â”‚  â”œâ”€ Ğ•ÑĞ»Ğ¸ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ (Â±1 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ°):                          â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ runScheduledMemes(ctx, POSTS_CHAT_ID)            â”‚ â”‚
â”‚  â”‚  â”œâ”€ ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ? ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ                â”‚ â”‚
â”‚  â”‚  â””â”€ sentTimes map Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ Ğ¾Ñ‚ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ²                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  sendScheduledMemes()                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¸Ğ· 3 Ğ¼ĞµĞ¼Ğ¾Ğ² (Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾):               â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ GetRandomMeme() Ğ¸Ğ· S3 Ğ¸Ğ½Ğ´ĞµĞºÑĞ°                    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ DownloadMemeToTemp() Ñ Ğ´Ğ¸ÑĞºĞ°                     â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ sendMemeVideo() Ğ² Ñ‡Ğ°Ñ‚                            â”‚ â”‚
â”‚  â”‚  â””â”€ Ğ—Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° 500ms Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ°Ğ¼Ğ¸                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ /scheduleinfo â†’ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ /runscheduled â†’ sendScheduledMemes() Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ        â”‚ â”‚
â”‚  â”‚  â”œâ”€ /meme â†’ handleMeme()                                â”‚ â”‚
â”‚  â”‚  â””â”€ ... Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†•
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   S3 Ğ¥Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ (MinIO)       â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚ schedule.json                â”‚
              â”‚ memes.json (Ğ¸Ğ½Ğ´ĞµĞºÑ)         â”‚
              â”‚ meme-001.mp4                â”‚
              â”‚ meme-002.mp4                â”‚
              â”‚ meme-003.mp4                â”‚
              â”‚ ...                         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

### 1. Config (`internal/config.go`)

```go
type Config struct {
    // ... ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ ...
    DailyGenerations int       // 1-10 Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğº Ğ² Ğ´ĞµĞ½ÑŒ
    PostsChatID      int64     // Chat ID Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸
    ScheduleJSONKey  string    // "schedule.json"
}
```

**Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ· Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ:**
```bash
DAILY_GENERATIONS=3
POSTS_CHAT_ID=-1001234567890
```

### 2. Schedule (`internal/scheduler/schedule.go`)

```go
// ScheduleEntry â€” Ğ¾Ğ´Ğ½Ğ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ°
type ScheduleEntry struct {
    Time time.Time
}

// DailySchedule â€” Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ½Ğ° Ğ´ĞµĞ½ÑŒ
type DailySchedule struct {
    Date      string          // "2026-01-28"
    Entries   []ScheduleEntry // N Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğº
    UpdatedAt time.Time
}

// BuildDailySchedule â€” ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
BuildDailySchedule(date, count) â†’ []time.Time

// GetOrCreateSchedule â€” Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ
GetOrCreateSchedule(ctx, s3, cfg, now) â†’ *DailySchedule
```

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ BuildDailySchedule:**
```
Ğ’Ñ…Ğ¾Ğ´: date = 2026-01-28, count = 3
Ğ’Ñ‹Ñ…Ğ¾Ğ´: [12:34:56, 16:45:23, 20:12:11]

1. ĞĞºĞ½Ğ¾: 10:00 Ğ´Ğ¾ 23:59 (14 Ñ‡Ğ°ÑĞ¾Ğ²)
2. Ğ Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ½Ğ° 3 Ñ€Ğ°Ğ²Ğ½Ñ‹Ğµ Ñ‡Ğ°ÑÑ‚Ğ¸:
   - Ğ§Ğ°ÑÑ‚ÑŒ 1: 10:00â€“13:20  â†’ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ² Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ğµ + jitter
   - Ğ§Ğ°ÑÑ‚ÑŒ 2: 13:20â€“16:40  â†’ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ² Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ğµ + jitter
   - Ğ§Ğ°ÑÑ‚ÑŒ 3: 16:40â€“19:59  â†’ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ² Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ğµ + jitter
3. Jitter: Â±30 Ğ¼Ğ¸Ğ½ÑƒÑ‚, Ğ½Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ñ‚Ñ€ĞµÑ‚Ğ¸ ÑĞµĞ³Ğ¼ĞµĞ½Ñ‚Ğ°
4. ĞÑ‚ÑĞ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
```

### 3. Service (`internal/scheduler/service.go`)

```go
type Service struct {
    impl      MemeService    // Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
    log       *Logger        // Ğ»Ğ¾Ğ³Ğ³ĞµÑ€
    cron      *cron.Cron    // cron Ğ´Ğ»Ñ maintenance
    
    // ĞĞ¾Ğ²Ğ¾Ğµ Ğ´Ğ»Ñ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ:
    cfg       Config
    s3c       s3.Client
    scheduleMux sync.Mutex
    schedule  *DailySchedule
}

// ĞœĞµÑ‚Ğ¾Ğ´Ñ‹:
GetSchedule() â†’ *DailySchedule           // Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾
SetSchedule(sched *DailySchedule)        // Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾
GetConfig() â†’ Config
GetS3Client() â†’ s3.Client
```

**Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**
```
BuildService():
  1. LoadConfig()
  2. Create S3Client
  3. Create schedulers/services
  4. Create Service Ñ cfg Ğ¸ s3c
  5. (Async) Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
  6. (Async) ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ EnsureSongs/Sources/Memes
```

### 4. TelegramBot (`internal/bot/telegram.go`)

```go
type TelegramBot struct {
    tg          *BotAPI
    svc         *scheduler.Service
    log         *Logger
    errorsPath  string
    
    // ĞĞ¾Ğ²Ğ¾Ğµ:
    schedulePosterDone chan struct{}
}

// ĞœĞµÑ‚Ğ¾Ğ´Ñ‹:
Run(ctx) â†’ Ğ³Ğ¾Ñ€ÑƒÑ‚Ğ¸Ğ½Ğ° Ğ´Ğ»Ñ scheduler.Service + Ğ³Ğ¾Ñ€ÑƒÑ‚Ğ¸Ğ½Ğ° Ğ´Ğ»Ñ runSchedulePoster
runSchedulePoster(ctx) â†’ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ†Ğ¸ĞºĞ» Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğº Ğ¿Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ
sendScheduledMemes(ctx, chatID) â†’ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ 3 Ğ¼ĞµĞ¼Ğ° Ğ² Ñ‡Ğ°Ñ‚
sendMemeVideo(ctx, chatID, meme) â†’ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¾Ğ´Ğ½Ğ¾ Ğ²Ğ¸Ğ´ĞµĞ¾
```

**ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ†Ğ¸ĞºĞ» runSchedulePoster:**
```go
for {
    select {
    case <-ctx.Done():
        return
    case <-ticker.C:  // ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 10 ÑĞµĞº
        now := time.Now()
        
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ĞºĞ°Ğ¶Ğ´Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ² Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğ¸
        for _, entry := range schedule.Entries {
            if !sent[entry.Time] && entry.TimeÂ±1min === now {
                sendScheduledMemes(ctx, chatID)
                sent[entry.Time] = true
            }
        }
        
        // ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ â†’ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
        if schedule.Date != now.Format("2006-01-02") {
            LoadOrCreateSchedule()
            sent = reset()
        }
    }
}
```

## ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### ĞŸÑ€Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ

```
1. main() â†’ BuildService()
   â†“
2. Service Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ
   â†“
3. (async) LoadSchedule Ğ¸Ğ· S3
   â†“
4. Service.SetSchedule(loaded)
   â†“
5. TelegramBot.Run() Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ runSchedulePoster()
   â†“
6. ĞĞ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 10 ÑĞµĞº
```

### ĞŸÑ€Ğ¸ Ğ½Ğ°ÑÑ‚ÑƒĞ¿Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸

```
1. runSchedulePoster() Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚: Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ === Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼Ñ?
   â†“
2. Ğ”Ğ° â†’ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ sendScheduledMemes()
   â†“
3. sendScheduledMemes():
   a. GetRandomMeme() Ğ¸Ğ· S3 Ğ¸Ğ½Ğ´ĞµĞºÑĞ° (memes.json)
   b. DownloadMemeToTemp() ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ²Ğ¸Ğ´ĞµĞ¾
   c. sendMemeVideo() Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ² Telegram
   (Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ´Ğ»Ñ 3 Ğ¼ĞµĞ¼Ğ¾Ğ²)
   â†“
4. ĞŸĞ¾Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ Ğ²Ñ€ĞµĞ¼Ñ ĞºĞ°Ğº Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ğ¾Ğµ (sentTimes[time])
   â†“
5. ĞĞ° ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
```

### ĞŸÑ€Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ Ğ±Ğ¾Ñ‚Ğ°

```
/scheduleinfo:
  GetSchedule() â†’ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼

/runscheduled:
  sendScheduledMemes(ctx, chatID) â†’ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ 3 Ğ¼ĞµĞ¼Ğ° ÑĞµĞ¹Ñ‡Ğ°Ñ

/meme:
  GetRandomMeme() â†’ sendMemeVideo() â†’ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ 1 Ğ¼ĞµĞ¼
```

## Ğ¥Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ (S3)

### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° S3 Ğ±Ğ°ĞºĞµÑ‚Ğ°

```
memes/
â”œâ”€â”€ schedule.json          â† Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ (ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Service)
â”œâ”€â”€ memes.json             â† Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ¼ĞµĞ¼Ğ¾Ğ² (Ğ¸Ğ· Python Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ğ°)
â”œâ”€â”€ meme-001.mp4           â† Ğ²Ğ¸Ğ´ĞµĞ¾ Ğ¼ĞµĞ¼Ğ¾Ğ²
â”œâ”€â”€ meme-002.mp4
â””â”€â”€ ...
```

### Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ schedule.json

```json
{
  "date": "2026-01-28",
  "entries": [
    {
      "time": "2026-01-28T12:34:56Z"
    },
    {
      "time": "2026-01-28T16:45:23Z"
    },
    {
      "time": "2026-01-28T20:12:11Z"
    }
  ],
  "updated_at": "2026-01-28T10:00:00Z"
}
```

## ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 1: 3 Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ² Ğ´ĞµĞ½ÑŒ

```bash
DAILY_GENERATIONS=3
POSTS_CHAT_ID=-1001234567890
```

Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:
- Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ: 12:30, 16:45, 20:15 (Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ½Ğ¾)
- ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿ĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 2: 5 Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğº Ğ² Ğ´ĞµĞ½ÑŒ

```bash
DAILY_GENERATIONS=5
POSTS_CHAT_ID=-1001234567890
```

Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:
- Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ: ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ ~2.8 Ñ‡Ğ°ÑĞ°
- ĞŸĞµÑ€Ğ²Ğ°Ñ Ğ² ~11:30, Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ² ~22:30

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 3: ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ

```bash
# ĞĞµ ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ğ¹Ñ‚Ğµ POSTS_CHAT_ID
```

Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:
- Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ Ğ½Ğ¾ Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ `/runscheduled` Ğ´Ğ»Ñ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸

## ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº

### ĞĞ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Service

```go
// Ğ•ÑĞ»Ğ¸ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ½Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ğ»Ğ¾ÑÑŒ:
if schedule == nil {
    log.Errorf("failed to load schedule")
    // Ğ‘Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ, Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‚
}
```

### ĞĞ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ TelegramBot

```go
// Ğ•ÑĞ»Ğ¸ POSTS_CHAT_ID Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½:
if chatID == 0 {
    log.Errorf("POSTS_CHAT_ID not set")
    return  // Poster Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ, Ğ½Ğ¾ Ğ±Ğ¾Ñ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
}

// Ğ•ÑĞ»Ğ¸ GetRandomMeme() Ğ¾ÑˆĞ¸Ğ±ÑÑ:
if err != nil {
    log.Errorf("get random meme %d: %v", i, err)
    continue  // ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼ Ğº ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼Ñƒ Ğ¼ĞµĞ¼Ñƒ
}
```

## ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### Mutex Ğ´Ğ»Ñ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ

```go
type Service struct {
    scheduleMux sync.Mutex
    schedule    *DailySchedule
}

func (s *Service) GetSchedule() *DailySchedule {
    s.scheduleMux.Lock()
    defer s.scheduleMux.Unlock()
    return s.schedule
}

func (s *Service) SetSchedule(sched *DailySchedule) {
    s.scheduleMux.Lock()
    defer s.scheduleMux.Unlock()
    s.schedule = sched
}
```

Ğ­Ñ‚Ğ¾ Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚, Ñ‡Ñ‚Ğ¾:
- runSchedulePoster Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
- SetSchedule Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğµ Ğ½Ğ° Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ
- ĞĞµÑ‚ race conditions

## Ğ§Ğ°ÑĞ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾ÑÑ Ğ¸ Ğ¾ĞºĞ½Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğº

### Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

```go
loc := time.FixedZone("Asia/Tomsk", 7*3600)  // UTC+7

// ĞĞºĞ½Ğ¾: 10:00 Ğ´Ğ¾ 23:59 (14 Ñ‡Ğ°ÑĞ¾Ğ²)
start := time.Date(year, month, day, 10, 0, 0, 0, loc)
end   := time.Date(year, month, day, 23, 59, 59, 0, loc)
```

ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ñ‡Ğ°ÑĞ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾ÑÑ, Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ² ÑÑ‚Ñ€Ğ¾ĞºÑƒ Ğ² `schedule.go`.

## Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Python Ğ²ĞµÑ€ÑĞ¸ĞµĞ¹

### Python bot Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚:
```
memes/
â”œâ”€â”€ meme-001.mp4  â† Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ²Ğ¸Ğ´ĞµĞ¾
â”œâ”€â”€ meme-002.mp4  â† Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ²Ğ¸Ğ´ĞµĞ¾
â””â”€â”€ memes.json    â† Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼Ñ‹Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ
```

### Go Ğ±Ğ¾Ñ‚ Ğ±ĞµÑ€Ñ‘Ñ‚:
```
memes/
â”œâ”€â”€ meme-001.mp4  â† Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ¸Ğ· Ğ¸Ğ½Ğ´ĞµĞºÑĞ°
â”œâ”€â”€ meme-002.mp4  â† ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€
â””â”€â”€ memes.json    â† Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ GetRandomMeme()
```

Ğ”Ğ²Ğ° Ğ±Ğ¾Ñ‚Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾ Ğ±ĞµĞ· ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ²!

## ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ’ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ (Ğ¾Ğ´Ğ¸Ğ½ Ğ¸Ğ½ÑÑ‚Ğ°Ğ½Ñ, Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğº)
```bash
DAILY_GENERATIONS=20  # 20 Ñ€Ğ°Ğ· Ğ² Ğ´ĞµĞ½ÑŒ
```

### Ğ“Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ (Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ½ÑÑ‚Ğ°Ğ½ÑĞ¾Ğ², Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ‡Ğ°Ñ‚Ñ‹)
```bash
# Ğ˜Ğ½ÑÑ‚Ğ°Ğ½Ñ 1
POSTS_CHAT_ID=-1001111111111

# Ğ˜Ğ½ÑÑ‚Ğ°Ğ½Ñ 2
POSTS_CHAT_ID=-1002222222222
```

ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¸Ğ½ÑÑ‚Ğ°Ğ½Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ ÑĞ²Ğ¾Ñ‘ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ (Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ğ¾Ğµ Ğ¸Ğ»Ğ¸ Ñ€Ğ°Ğ·Ğ½Ğ¾Ğµ).
